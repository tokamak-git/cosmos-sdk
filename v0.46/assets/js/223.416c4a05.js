(window.webpackJsonp=window.webpackJsonp||[]).push([[223],{746:function(e,g,c){"use strict";c.r(g);var a=c(1),t=Object(a.a)({},(function(){var e=this,g=e.$createElement,c=e._self._c||g;return c("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[c("h1",{attrs:{id:"state"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#state"}},[e._v("#")]),e._v(" State")]),e._v(" "),c("h2",{attrs:{id:"proposals"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#proposals"}},[e._v("#")]),e._v(" Proposals")]),e._v(" "),c("p",[c("code",[e._v("Proposal")]),e._v(" objects are used to tally votes and generally track the proposal's state.\nThey contain an array of arbitrary "),c("code",[e._v("sdk.Msg")]),e._v("'s which the governance module will attempt\nto resolve and then execute if the proposal passes. "),c("code",[e._v("Proposal")]),e._v("'s are identified by a\nunique id and contains a series of timestamps: "),c("code",[e._v("submit_time")]),e._v(", "),c("code",[e._v("deposit_end_time")]),e._v(",\n"),c("code",[e._v("voting_start_time")]),e._v(", "),c("code",[e._v("voting_end_time")]),e._v(" which track the lifecycle of a proposal")]),e._v(" "),c("p",[c("tm-code-block",{staticClass:"codeblock",attrs:{language:"false",base64:"bWVzc2FnZSBQcm9wb3NhbCB7CiAgdWludDY0ICAgcHJvcG9zYWxfaWQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gMTsKICByZXBlYXRlZCBnb29nbGUucHJvdG9idWYuQW55IG1lc3NhZ2VzICAgICAgICAgICAgICAgPSAyOwogIFByb3Bvc2FsU3RhdHVzICAgICAgICAgICAgICAgc3RhdHVzICAgICAgICAgICAgICAgICA9IDM7CiAgVGFsbHlSZXN1bHQgICAgICAgICAgICAgICAgICBmaW5hbF90YWxseV9yZXN1bHQgICAgID0gNDsKICBnb29nbGUucHJvdG9idWYuVGltZXN0YW1wICAgIHN1Ym1pdF90aW1lICAgICAgICAgICAgPSA1IFsoZ29nb3Byb3RvLnN0ZHRpbWUpID0gdHJ1ZV07CiAgZ29vZ2xlLnByb3RvYnVmLlRpbWVzdGFtcCAgICBkZXBvc2l0X2VuZF90aW1lICAgICAgID0gNiBbKGdvZ29wcm90by5zdGR0aW1lKSA9IHRydWVdOwogIHJlcGVhdGVkIGNvc21vcy5iYXNlLnYxYmV0YTEuQ29pbiB0b3RhbF9kZXBvc2l0ICAgICA9IDc7CiAgZ29vZ2xlLnByb3RvYnVmLlRpbWVzdGFtcCAgICAgICAgIHZvdGluZ19zdGFydF90aW1lID0gOCBbKGdvZ29wcm90by5zdGR0aW1lKSA9IHRydWVdOwogIGdvb2dsZS5wcm90b2J1Zi5UaW1lc3RhbXAgICAgICAgICB2b3RpbmdfZW5kX3RpbWUgICA9IDkgWyhnb2dvcHJvdG8uc3RkdGltZSkgPSB0cnVlXTsKfQ=="}})],1),e._v(" "),c("p",[e._v("A proposal will generally require more than just a set of messages to explain its\npurpose but need some greater justification and allow a means for interested participants\nto discuss and debate the proposal. In most cases, it is encouraged to have an off-chain\nsystem that supports the on-chain governance process. To accommodate for this, a\nproposal contains a special "),c("code",[e._v("metadata")]),e._v(" field, an array of bytes, which can be used to\nadd context to the proposal. The "),c("code",[e._v("metadata")]),e._v(" field allows custom use for networks, however,\nit is expected that the field contain a URL or some form of CID using a system such as\n"),c("a",{attrs:{href:"https://docs.ipfs.io/concepts/content-addressing/",target:"_blank",rel:"noopener noreferrer"}},[e._v("IPFS"),c("OutboundLink")],1),e._v(". To support the case of\ninteroperability across networks, the SDK recommends that the "),c("code",[e._v("metadata")]),e._v(" represents\nthe following "),c("code",[e._v("JSON")]),e._v(" template:")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"ewogICZxdW90O3RpdGxlJnF1b3Q7OiAmcXVvdDsuLi4mcXVvdDssCiAgJnF1b3Q7ZGVzY3JpcHRpb24mcXVvdDs6ICZxdW90Oy4uLiZxdW90OywKICAmcXVvdDtmb3J1bSZxdW90OzogJnF1b3Q7Li4uJnF1b3Q7LCAvLyBhIGxpbmsgdG8gdGhlIGRpc2N1c3Npb24gcGxhdGZvcm0gKGkuZS4gRGlzY29yZCkKICAmcXVvdDtvdGhlciZxdW90OzogJnF1b3Q7Li4uJnF1b3Q7IC8vIGFueSBleHRyYSBkYXRhIHRoYXQgZG9lc24ndCBjb3JyZXNwb25kIHRvIHRoZSBvdGhlciBmaWVsZHMKfQo="}}),e._v(" "),c("p",[e._v("This makes it far easier for clients to support multiple networks.")]),e._v(" "),c("p",[e._v("The metadata has a maximum length that is chosen by the app developer, and\npassed into the gov keeper as a config.")]),e._v(" "),c("h3",{attrs:{id:"writing-a-module-that-uses-governance"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#writing-a-module-that-uses-governance"}},[e._v("#")]),e._v(" Writing a module that uses governance")]),e._v(" "),c("p",[e._v("There are many aspects of a chain, or of the individual modules that you may want to\nuse governance to perform such as changing various parameters. This is very simple\nto do. First, write out your message types and "),c("code",[e._v("MsgServer")]),e._v(" implementation. Add an\n"),c("code",[e._v("authority")]),e._v(" field to the keeper which will be populated in the constructor with the\ngovernance module account: "),c("code",[e._v("govKeeper.GetGovernanceAccount().GetAddress()")]),e._v(". Then for\nthe methods in the "),c("code",[e._v("msg_server.go")]),e._v(", perform a check on the message that the signer\nmatches "),c("code",[e._v("authority")]),e._v(". This will prevent any user from executing that message.")]),e._v(" "),c("h2",{attrs:{id:"parameters-and-base-types"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#parameters-and-base-types"}},[e._v("#")]),e._v(" Parameters and base types")]),e._v(" "),c("p",[c("code",[e._v("Parameters")]),e._v(" define the rules according to which votes are run. There can only\nbe one active parameter set at any given time. If governance wants to change a\nparameter set, either to modify a value or add/remove a parameter field, a new\nparameter set has to be created and the previous one rendered inactive.")]),e._v(" "),c("h3",{attrs:{id:"depositparams"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#depositparams"}},[e._v("#")]),e._v(" DepositParams")]),e._v(" "),c("p",[c("tm-code-block",{staticClass:"codeblock",attrs:{language:"false",base64:"Ly8gRGVwb3NpdFBhcmFtcyBkZWZpbmVzIHRoZSBwYXJhbXMgZm9yIGRlcG9zaXRzIG9uIGdvdmVybmFuY2UgcHJvcG9zYWxzLgptZXNzYWdlIERlcG9zaXRQYXJhbXMgewogIC8vICBNaW5pbXVtIGRlcG9zaXQgZm9yIGEgcHJvcG9zYWwgdG8gZW50ZXIgdm90aW5nIHBlcmlvZC4KICByZXBlYXRlZCBjb3Ntb3MuYmFzZS52MWJldGExLkNvaW4gbWluX2RlcG9zaXQgPSAxIFsKICAgIChnb2dvcHJvdG8ubnVsbGFibGUpICAgICA9IGZhbHNlLAogICAgKGdvZ29wcm90by5jYXN0cmVwZWF0ZWQpID0gJnF1b3Q7Z2l0aHViLmNvbS9jb3Ntb3MvY29zbW9zLXNkay90eXBlcy5Db2lucyZxdW90OywKICAgIChnb2dvcHJvdG8ubW9yZXRhZ3MpICAgICA9ICZxdW90O3lhbWw6XCZxdW90O21pbl9kZXBvc2l0XCZxdW90OyZxdW90OywKICAgIChnb2dvcHJvdG8uanNvbnRhZykgICAgICA9ICZxdW90O21pbl9kZXBvc2l0LG9taXRlbXB0eSZxdW90OwogIF07CgogIC8vICBNYXhpbXVtIHBlcmlvZCBmb3IgQXRvbSBob2xkZXJzIHRvIGRlcG9zaXQgb24gYSBwcm9wb3NhbC4gSW5pdGlhbCB2YWx1ZTogMgogIC8vICBtb250aHMuCiAgZ29vZ2xlLnByb3RvYnVmLkR1cmF0aW9uIG1heF9kZXBvc2l0X3BlcmlvZCA9IDIgWwogICAgKGdvZ29wcm90by5udWxsYWJsZSkgICAgPSBmYWxzZSwKICAgIChnb2dvcHJvdG8uc3RkZHVyYXRpb24pID0gdHJ1ZSwKICAgIChnb2dvcHJvdG8uanNvbnRhZykgICAgID0gJnF1b3Q7bWF4X2RlcG9zaXRfcGVyaW9kLG9taXRlbXB0eSZxdW90OywKICAgIChnb2dvcHJvdG8ubW9yZXRhZ3MpICAgID0gJnF1b3Q7eWFtbDpcJnF1b3Q7bWF4X2RlcG9zaXRfcGVyaW9kXCZxdW90OyZxdW90OwogIF07Cn0="}})],1),e._v(" "),c("h3",{attrs:{id:"votingparams"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#votingparams"}},[e._v("#")]),e._v(" VotingParams")]),e._v(" "),c("p",[c("tm-code-block",{staticClass:"codeblock",attrs:{language:"false",base64:"Ly8gVm90aW5nUGFyYW1zIGRlZmluZXMgdGhlIHBhcmFtcyBmb3Igdm90aW5nIG9uIGdvdmVybmFuY2UgcHJvcG9zYWxzLgptZXNzYWdlIFZvdGluZ1BhcmFtcyB7CiAgLy8gIExlbmd0aCBvZiB0aGUgdm90aW5nIHBlcmlvZC4KICBnb29nbGUucHJvdG9idWYuRHVyYXRpb24gdm90aW5nX3BlcmlvZCA9IDEgWwogICAgKGdvZ29wcm90by5udWxsYWJsZSkgICAgPSBmYWxzZSwKICAgIChnb2dvcHJvdG8uc3RkZHVyYXRpb24pID0gdHJ1ZSwKICAgIChnb2dvcHJvdG8uanNvbnRhZykgICAgID0gJnF1b3Q7dm90aW5nX3BlcmlvZCxvbWl0ZW1wdHkmcXVvdDssCiAgICAoZ29nb3Byb3RvLm1vcmV0YWdzKSAgICA9ICZxdW90O3lhbWw6XCZxdW90O3ZvdGluZ19wZXJpb2RcJnF1b3Q7JnF1b3Q7CiAgXTsKfQ=="}})],1),e._v(" "),c("h3",{attrs:{id:"tallyparams"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#tallyparams"}},[e._v("#")]),e._v(" TallyParams")]),e._v(" "),c("p",[c("tm-code-block",{staticClass:"codeblock",attrs:{language:"false",base64:"Ly8gVGFsbHlQYXJhbXMgZGVmaW5lcyB0aGUgcGFyYW1zIGZvciB0YWxseWluZyB2b3RlcyBvbiBnb3Zlcm5hbmNlIHByb3Bvc2Fscy4KbWVzc2FnZSBUYWxseVBhcmFtcyB7CiAgLy8gIE1pbmltdW0gcGVyY2VudGFnZSBvZiB0b3RhbCBzdGFrZSBuZWVkZWQgdG8gdm90ZSBmb3IgYSByZXN1bHQgdG8gYmUKICAvLyAgY29uc2lkZXJlZCB2YWxpZC4KICBieXRlcyBxdW9ydW0gPSAxIFsKICAgIChnb2dvcHJvdG8uY3VzdG9tdHlwZSkgPSAmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9jb3Ntb3Mtc2RrL3R5cGVzLkRlYyZxdW90OywKICAgIChnb2dvcHJvdG8ubnVsbGFibGUpICAgPSBmYWxzZSwKICAgIChnb2dvcHJvdG8uanNvbnRhZykgICAgPSAmcXVvdDtxdW9ydW0sb21pdGVtcHR5JnF1b3Q7CiAgXTsKCiAgLy8gIE1pbmltdW0gcHJvcG9ydGlvbiBvZiBZZXMgdm90ZXMgZm9yIHByb3Bvc2FsIHRvIHBhc3MuIERlZmF1bHQgdmFsdWU6IDAuNS4KICBieXRlcyB0aHJlc2hvbGQgPSAyIFsKICAgIChnb2dvcHJvdG8uY3VzdG9tdHlwZSkgPSAmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9jb3Ntb3Mtc2RrL3R5cGVzLkRlYyZxdW90OywKICAgIChnb2dvcHJvdG8ubnVsbGFibGUpICAgPSBmYWxzZSwKICAgIChnb2dvcHJvdG8uanNvbnRhZykgICAgPSAmcXVvdDt0aHJlc2hvbGQsb21pdGVtcHR5JnF1b3Q7CiAgXTsKCiAgLy8gIE1pbmltdW0gdmFsdWUgb2YgVmV0byB2b3RlcyB0byBUb3RhbCB2b3RlcyByYXRpbyBmb3IgcHJvcG9zYWwgdG8gYmUKICAvLyAgdmV0b2VkLiBEZWZhdWx0IHZhbHVlOiAxLzMuCiAgYnl0ZXMgdmV0b190aHJlc2hvbGQgPSAzIFsKICAgIChnb2dvcHJvdG8uY3VzdG9tdHlwZSkgPSAmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9jb3Ntb3Mtc2RrL3R5cGVzLkRlYyZxdW90OywKICAgIChnb2dvcHJvdG8ubnVsbGFibGUpICAgPSBmYWxzZSwKICAgIChnb2dvcHJvdG8uanNvbnRhZykgICAgPSAmcXVvdDt2ZXRvX3RocmVzaG9sZCxvbWl0ZW1wdHkmcXVvdDssCiAgICAoZ29nb3Byb3RvLm1vcmV0YWdzKSAgID0gJnF1b3Q7eWFtbDpcJnF1b3Q7dmV0b190aHJlc2hvbGRcJnF1b3Q7JnF1b3Q7CiAgXTsKfQ=="}})],1),e._v(" "),c("p",[e._v("Parameters are stored in a global "),c("code",[e._v("GlobalParams")]),e._v(" KVStore.")]),e._v(" "),c("p",[e._v("Additionally, we introduce some basic types:")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBWb3RlIGJ5dGUKCmNvbnN0ICgKICAgIFZvdGVZZXMgICAgICAgICA9IDB4MQogICAgVm90ZU5vICAgICAgICAgID0gMHgyCiAgICBWb3RlTm9XaXRoVmV0byAgPSAweDMKICAgIFZvdGVBYnN0YWluICAgICA9IDB4NAopCgp0eXBlIFByb3Bvc2FsVHlwZSAgc3RyaW5nCgpjb25zdCAoCiAgICBQcm9wb3NhbFR5cGVQbGFpblRleHQgICAgICAgPSAmcXVvdDtUZXh0JnF1b3Q7CiAgICBQcm9wb3NhbFR5cGVTb2Z0d2FyZVVwZ3JhZGUgPSAmcXVvdDtTb2Z0d2FyZVVwZ3JhZGUmcXVvdDsKKQoKdHlwZSBQcm9wb3NhbFN0YXR1cyBieXRlCgoKY29uc3QgKAoJU3RhdHVzTmlsICAgICAgICAgICBQcm9wb3NhbFN0YXR1cyA9IDB4MDAKICAgIFN0YXR1c0RlcG9zaXRQZXJpb2QgUHJvcG9zYWxTdGF0dXMgPSAweDAxICAvLyBQcm9wb3NhbCBpcyBzdWJtaXR0ZWQuIFBhcnRpY2lwYW50cyBjYW4gZGVwb3NpdCBvbiBpdCBidXQgbm90IHZvdGUKICAgIFN0YXR1c1ZvdGluZ1BlcmlvZCAgUHJvcG9zYWxTdGF0dXMgPSAweDAyICAvLyBNaW5EZXBvc2l0IGlzIHJlYWNoZWQsIHBhcnRpY2lwYW50cyBjYW4gdm90ZQogICAgU3RhdHVzUGFzc2VkICAgICAgICBQcm9wb3NhbFN0YXR1cyA9IDB4MDMgIC8vIFByb3Bvc2FsIHBhc3NlZCBhbmQgc3VjY2Vzc2Z1bGx5IGV4ZWN1dGVkCiAgICBTdGF0dXNSZWplY3RlZCAgICAgIFByb3Bvc2FsU3RhdHVzID0gMHgwNCAgLy8gUHJvcG9zYWwgaGFzIGJlZW4gcmVqZWN0ZWQKICAgIFN0YXR1c0ZhaWxlZCAgICAgICAgUHJvcG9zYWxTdGF0dXMgPSAweDA1ICAvLyBQcm9wb3NhbCBwYXNzZWQgYnV0IGZhaWxlZCBleGVjdXRpb24KKQo="}}),e._v(" "),c("h2",{attrs:{id:"deposit"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#deposit"}},[e._v("#")]),e._v(" Deposit")]),e._v(" "),c("p",[c("tm-code-block",{staticClass:"codeblock",attrs:{language:"false",base64:"Ly8gRGVwb3NpdCBkZWZpbmVzIGFuIGFtb3VudCBkZXBvc2l0ZWQgYnkgYW4gYWNjb3VudCBhZGRyZXNzIHRvIGFuIGFjdGl2ZQovLyBwcm9wb3NhbC4KbWVzc2FnZSBEZXBvc2l0IHsKICBvcHRpb24gKGdvZ29wcm90by5nb3Byb3RvX2dldHRlcnMpID0gZmFsc2U7CiAgb3B0aW9uIChnb2dvcHJvdG8uZXF1YWwpICAgICAgICAgICA9IGZhbHNlOwoKICB1aW50NjQgICBwcm9wb3NhbF9pZCAgICAgICAgICAgICAgICAgICAgID0gMSBbKGdvZ29wcm90by5tb3JldGFncykgPSAmcXVvdDt5YW1sOlwmcXVvdDtwcm9wb3NhbF9pZFwmcXVvdDsmcXVvdDtdOwogIHN0cmluZyAgIGRlcG9zaXRvciAgICAgICAgICAgICAgICAgICAgICAgPSAyOwogIHJlcGVhdGVkIGNvc21vcy5iYXNlLnYxYmV0YTEuQ29pbiBhbW91bnQgPSAzCiAgICAgIFsoZ29nb3Byb3RvLm51bGxhYmxlKSA9IGZhbHNlLCAoZ29nb3Byb3RvLmNhc3RyZXBlYXRlZCkgPSAmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9jb3Ntb3Mtc2RrL3R5cGVzLkNvaW5zJnF1b3Q7XTsKfQ=="}})],1),e._v(" "),c("h2",{attrs:{id:"validatorgovinfo"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#validatorgovinfo"}},[e._v("#")]),e._v(" ValidatorGovInfo")]),e._v(" "),c("p",[e._v("This type is used in a temp map when tallying")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ICB0eXBlIFZhbGlkYXRvckdvdkluZm8gc3RydWN0IHsKICAgIE1pbnVzICAgICBzZGsuRGVjCiAgICBWb3RlICAgICAgVm90ZQogIH0K"}}),e._v(" "),c("h2",{attrs:{id:"stores"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#stores"}},[e._v("#")]),e._v(" Stores")]),e._v(" "),c("p",[c("em",[e._v("Stores are KVStores in the multi-store. The key to find the store is the first\nparameter in the list")]),e._v("`")]),e._v(" "),c("p",[e._v("We will use one KVStore "),c("code",[e._v("Governance")]),e._v(" to store two mappings:")]),e._v(" "),c("ul",[c("li",[e._v("A mapping from "),c("code",[e._v("proposalID|'proposal'")]),e._v(" to "),c("code",[e._v("Proposal")]),e._v(".")]),e._v(" "),c("li",[e._v("A mapping from "),c("code",[e._v("proposalID|'addresses'|address")]),e._v(" to "),c("code",[e._v("Vote")]),e._v(". This mapping allows\nus to query all addresses that voted on the proposal along with their vote by\ndoing a range query on "),c("code",[e._v("proposalID:addresses")]),e._v(".")])]),e._v(" "),c("p",[e._v("For pseudocode purposes, here are the two function we will use to read or write in stores:")]),e._v(" "),c("ul",[c("li",[c("code",[e._v("load(StoreKey, Key)")]),e._v(": Retrieve item stored at key "),c("code",[e._v("Key")]),e._v(" in store found at key "),c("code",[e._v("StoreKey")]),e._v(" in the multistore")]),e._v(" "),c("li",[c("code",[e._v("store(StoreKey, Key, value)")]),e._v(": Write value "),c("code",[e._v("Value")]),e._v(" at key "),c("code",[e._v("Key")]),e._v(" in store found at key "),c("code",[e._v("StoreKey")]),e._v(" in the multistore")])]),e._v(" "),c("h2",{attrs:{id:"proposal-processing-queue"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#proposal-processing-queue"}},[e._v("#")]),e._v(" Proposal Processing Queue")]),e._v(" "),c("p",[c("strong",[e._v("Store:")])]),e._v(" "),c("ul",[c("li",[c("code",[e._v("ProposalProcessingQueue")]),e._v(": A queue "),c("code",[e._v("queue[proposalID]")]),e._v(" containing all the\n"),c("code",[e._v("ProposalIDs")]),e._v(" of proposals that reached "),c("code",[e._v("MinDeposit")]),e._v(". During each "),c("code",[e._v("EndBlock")]),e._v(",\nall the proposals that have reached the end of their voting period are processed.\nTo process a finished proposal, the application tallies the votes, computes the\nvotes of each validator and checks if every validator in the validator set has\nvoted. If the proposal is accepted, deposits are refunded. Finally, the proposal\ncontent "),c("code",[e._v("Handler")]),e._v(" is executed.")])]),e._v(" "),c("p",[e._v("And the pseudocode for the "),c("code",[e._v("ProposalProcessingQueue")]),e._v(":")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ICBpbiBFbmRCbG9jayBkbwoKICAgIGZvciBmaW5pc2hlZFByb3Bvc2FsSUQgaW4gR2V0QWxsRmluaXNoZWRQcm9wb3NhbElEcyhibG9jay5UaW1lKQogICAgICBwcm9wb3NhbCA9IGxvYWQoR292ZXJuYW5jZSwgJmx0O3Byb3Bvc2FsSUR8J3Byb3Bvc2FsJyZndDspIC8vIHByb3Bvc2FsIGlzIGEgY29uc3Qga2V5CgogICAgICB2YWxpZGF0b3JzID0gS2VlcGVyLmdldEFsbFZhbGlkYXRvcnMoKQogICAgICB0bXBWYWxNYXAgOj0gbWFwKHNkay5BY2NBZGRyZXNzKVZhbGlkYXRvckdvdkluZm8KCiAgICAgIC8vIEluaXRpYXRlIG1hcHBpbmcgYXQgMC4gVGhpcyBpcyB0aGUgYW1vdW50IG9mIHNoYXJlcyBvZiB0aGUgdmFsaWRhdG9yJ3Mgdm90ZSB0aGF0IHdpbGwgYmUgb3ZlcnJpZGRlbiBieSB0aGVpciBkZWxlZ2F0b3IncyB2b3RlcwogICAgICBmb3IgZWFjaCB2YWxpZGF0b3IgaW4gdmFsaWRhdG9ycwogICAgICAgIHRtcFZhbE1hcCh2YWxpZGF0b3IuT3BlcmF0b3JBZGRyKS5NaW51cyA9IDAKCiAgICAgIC8vIFRhbGx5CiAgICAgIHZvdGVySXRlcmF0b3IgPSByYW5nZVF1ZXJ5KEdvdmVybmFuY2UsICZsdDtwcm9wb3NhbElEfCdhZGRyZXNzZXMnJmd0OykgLy9yZXR1cm4gYWxsIHRoZSBhZGRyZXNzZXMgdGhhdCB2b3RlZCBvbiB0aGUgcHJvcG9zYWwKICAgICAgZm9yIGVhY2ggKHZvdGVyQWRkcmVzcywgdm90ZSkgaW4gdm90ZXJJdGVyYXRvcgogICAgICAgIGRlbGVnYXRpb25zID0gc3Rha2luZ0tlZXBlci5nZXREZWxlZ2F0aW9ucyh2b3RlckFkZHJlc3MpIC8vIGdldCBhbGwgZGVsZWdhdGlvbnMgZm9yIGN1cnJlbnQgdm90ZXIKCiAgICAgICAgZm9yIGVhY2ggZGVsZWdhdGlvbiBpbiBkZWxlZ2F0aW9ucwogICAgICAgICAgLy8gbWFrZSBzdXJlIGRlbGVnYXRpb24uU2hhcmVzIGRvZXMgTk9UIGluY2x1ZGUgc2hhcmVzIGJlaW5nIHVuYm9uZGVkCiAgICAgICAgICB0bXBWYWxNYXAoZGVsZWdhdGlvbi5WYWxpZGF0b3JBZGRyKS5NaW51cyArPSBkZWxlZ2F0aW9uLlNoYXJlcwogICAgICAgICAgcHJvcG9zYWwudXBkYXRlVGFsbHkodm90ZSwgZGVsZWdhdGlvbi5TaGFyZXMpCgogICAgICAgIF8sIGlzVmFsID0gc3Rha2luZ0tlZXBlci5nZXRWYWxpZGF0b3Iodm90ZXJBZGRyZXNzKQogICAgICAgIGlmIChpc1ZhbCkKICAgICAgICAgIHRtcFZhbE1hcCh2b3RlckFkZHJlc3MpLlZvdGUgPSB2b3RlCgogICAgICB0YWxseWluZ1BhcmFtID0gbG9hZChHbG9iYWxQYXJhbXMsICdUYWxseWluZ1BhcmFtJykKCiAgICAgIC8vIFVwZGF0ZSB0YWxseSBpZiB2YWxpZGF0b3Igdm90ZWQgdGhleSB2b3RlZAogICAgICBmb3IgZWFjaCB2YWxpZGF0b3IgaW4gdmFsaWRhdG9ycwogICAgICAgIGlmIHRtcFZhbE1hcCh2YWxpZGF0b3IpLkhhc1ZvdGVkCiAgICAgICAgICBwcm9wb3NhbC51cGRhdGVUYWxseSh0bXBWYWxNYXAodmFsaWRhdG9yKS5Wb3RlLCAodmFsaWRhdG9yLlRvdGFsU2hhcmVzIC0gdG1wVmFsTWFwKHZhbGlkYXRvcikuTWludXMpKQoKCgogICAgICAvLyBDaGVjayBpZiBwcm9wb3NhbCBpcyBhY2NlcHRlZCBvciByZWplY3RlZAogICAgICB0b3RhbE5vbkFic3RhaW4gOj0gcHJvcG9zYWwuWWVzVm90ZXMgKyBwcm9wb3NhbC5Ob1ZvdGVzICsgcHJvcG9zYWwuTm9XaXRoVmV0b1ZvdGVzCiAgICAgIGlmIChwcm9wb3NhbC5Wb3Rlcy5ZZXNWb3Rlcy90b3RhbE5vbkFic3RhaW4gJmd0OyB0YWxseWluZ1BhcmFtLlRocmVzaG9sZCBBTkQgcHJvcG9zYWwuVm90ZXMuTm9XaXRoVmV0b1ZvdGVzL3RvdGFsTm9uQWJzdGFpbiAgJmx0OyB0YWxseWluZ1BhcmFtLlZldG8pCiAgICAgICAgLy8gIHByb3Bvc2FsIHdhcyBhY2NlcHRlZCBhdCB0aGUgZW5kIG9mIHRoZSB2b3RpbmcgcGVyaW9kCiAgICAgICAgLy8gIHJlZnVuZCBkZXBvc2l0cyAobm9uLXZvdGVycyBhbHJlYWR5IHB1bmlzaGVkKQogICAgICAgIGZvciBlYWNoIChhbW91bnQsIGRlcG9zaXRvcikgaW4gcHJvcG9zYWwuRGVwb3NpdHMKICAgICAgICAgIGRlcG9zaXRvci5BdG9tQmFsYW5jZSArPSBhbW91bnQKCiAgICAgICAgc3RhdGVXcml0ZXIsIGVyciA6PSBwcm9wb3NhbC5IYW5kbGVyKCkKICAgICAgICBpZiBlcnIgIT0gbmlsCiAgICAgICAgICAgIC8vIHByb3Bvc2FsIHBhc3NlZCBidXQgZmFpbGVkIGR1cmluZyBzdGF0ZSBleGVjdXRpb24KICAgICAgICAgICAgcHJvcG9zYWwuQ3VycmVudFN0YXR1cyA9IFByb3Bvc2FsU3RhdHVzRmFpbGVkCiAgICAgICAgIGVsc2UKICAgICAgICAgICAgLy8gcHJvcG9zYWwgcGFzcyBhbmQgc3RhdGUgaXMgcGVyc2lzdGVkCiAgICAgICAgICAgIHByb3Bvc2FsLkN1cnJlbnRTdGF0dXMgPSBQcm9wb3NhbFN0YXR1c0FjY2VwdGVkCiAgICAgICAgICAgIHN0YXRlV3JpdGVyLnNhdmUoKQogICAgICBlbHNlCiAgICAgICAgLy8gcHJvcG9zYWwgd2FzIHJlamVjdGVkCiAgICAgICAgcHJvcG9zYWwuQ3VycmVudFN0YXR1cyA9IFByb3Bvc2FsU3RhdHVzUmVqZWN0ZWQKCiAgICAgIHN0b3JlKEdvdmVybmFuY2UsICZsdDtwcm9wb3NhbElEfCdwcm9wb3NhbCcmZ3Q7LCBwcm9wb3NhbCkK"}})],1)}),[],!1,null,null,null);g.default=t.exports}}]);